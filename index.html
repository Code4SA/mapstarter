<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Mapstarter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->    
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="css/highlight.tomorrow.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="css/mapstarter.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../../assets/js/html5shiv.js"></script>
      <script src="../../assets/js/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <!-- Fixed navbar -->
    <div class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <span class="navbar-brand">Mapstarter</span>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active" id="choose-file"><a href="#choose-file">Choose File...</a></li>
            <li id="size"><a href="#size">Size/Projection</a></li>
            <li id="color"><a href="#color">Colors</a></li>
            <li id="behavior"><a href="#behavior">Behavior</a></li>
            <li id="data"><a href="#data">Data</a></li>
            <li class="dropdown" id="download">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Download <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li id="download-svg"><a href="#download-svg">SVG</a></li>
                <li id="download-image"><a href="#download-image">Image</a></li>
                <li id="download-code"><a href="#download-code">Code</a></li>
              </ul>
            </li>            
            <li><a href="#help" id="help">Help</a></li>            
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">    
      <div class="alert alert-dismissable hidden"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><div class="alert-inner"></div></div>
    </div>

    <div class="container mapstarter-section" id="section-choose-file">      
      <div class="panel panel-default" id="upload-target">
        <div class="panel-body">
          <div id="file-prompt">
            Drag a shapefile, GeoJSON, or TopoJSON file here, or click to select one
          </div>
          <div class="progress progress-striped active">
            <div class="progress-bar"  role="progressbar" aria-valuenow="100" aria-valuemin="100" aria-valuemax="100" style="width: 100%">    
            </div>
          </div>
        </div>
      </div>
      <input type="file" id="upload-file" style="display: none;" />
      <div>
        Or try a sample data file:
        <a href="#sample-data" data-filename="ca.json" class="sample-data">California congressional districts</a>
        <a href="#sample-data" data-filename="pakistan.json" class="sample-data">Pakistan electoral districts</a>
        <a href="#sample-data" data-filename="africa.json" class="sample-data">Africa</a>
        <a href="#sample-data" data-filename="southamerica.json" class="sample-data">South America</a>
        <a href="#sample-data" data-filename="random" class="sample-data">Random country</a>
      </div>
    </div><!-- /container -->

    <div class="container mapstarter-section hidden" id="section-help">    
      <p class="lead">Mapstarter is a tool for turning a geographic data file into a map for the web.</p>
      <p class="lead">This is a work in progress.  Got ideas?  Requests?  Complaints?  Data files that didn't work?  <a href="mailto:noah@noahveltman.com">Let me know</a>.</p>
      <h3>How does it work?</h3>
      <p class="lead">Select a GeoJSON file, TopoJSON file, or ESRI Shapefile.  It will import your data and give you a starting interactive map, automatically scaled to fit your data.  You can change the dimensions, map projection, color scheme, and add basic behaviors like zoom and tooltips. You can also inspect the data stored in your file in the "Data" tab.</p>

      <p class="lead">Once you've got something you like, you can export it in one of three formats:</p>      
      <ul class="lead">
        <li><strong>SVG</strong>: useful if you want a starting template to further customize as a flat graphic (e.g. in Adobe Illustrator).</li>
        <li><strong>Image</strong>: useful if you want an instant flat image of your map.</li>
        <li><strong>Code</strong>: useful if you're a web developer or have access to one, and you want to put this up on the web in an interactive form.  You'll get a basic working page with the JavaScript to generate your map, which you can then go trick out with extra cleverness.</li>
      </ul>

      <h3>Who is this for?</h3>
      <p class="lead"><strong>Designers</strong> who want to get a headstart on a custom map they're going to work on in graphics software.</p>
      <p class="lead"><strong>Reporters</strong> who want to get a quick idea of what's actually in a data file and how an interactive web map approach would look.</p>
      <p class="lead"><strong>Web developers</strong> who want to get a sensible starting template without a copy/paste scavenger hunt or a dozen syntax errors.</p>

      <h3>Who is this NOT for?</h3>
      <p class="lead">People who want to edit their geodata.  This currently doesn't have any editing features, it assumes your data is pretty much ready to go. See <strong>Other tools and resources</strong> below for some tools for this.</p>
      <p class="lead">People who want to make Google Maps-style tile maps that you can slip and slide around.  This is meant for more focused maps that ignore the world at large.  Think election maps.  See <strong>Other tools and resources</strong> below for some tools for tile maps.</p>
      <p class="lead">People who want to make complex, multilayered, or heavily stylized maps.  This may still provide a useful starting point for that, but it's not going to get you very far.</p>
      <p class="lead">Mike Bostock.</p>

      <h3>Some details/caveats</h3>     
      <p class="lead">To import a shapefile, it must be a .zip file containing a .shp file, .dbf file, and .shx file (it can contain a .prj file too, but that's optional).</p>
      <p class="lead">This will currently only support a single layer of geometries.  If, for example, you have a TopoJSON file with census tracts, counties, and states, all stored separately, it will only draw one of them.  I hope to fix this (see <strong>To do list</strong>).</p>
      <p class="lead">If you download the code for your map, it will rely on <a href="http://d3js.org/">D3</a> for most of the heavy lifting.  D3 is not compatible with IE8 and below, so if you need to serve old browsers, make sure you include an image fallback of some sort.</p>
      <p class="lead">If you already have GeoJSON/TopoJSON, you can run this without an internet connection.  The only pieces that require an internet connection are importing a shapefile, which currently uses the <a href="http://ogre.adc4gis.com/">ADC ogr2ogr converter</a>, and converting from GeoJSON to TopoJSON.  If you want to run it locally, you can clone the <a href="https://github.com/veltman/mapstarter">GitHub repository</a> and open index.html.</p>
      <p class="lead">This will only work on modern browsers, and I wouldn't recommend using it on your smartphone.</p>

      <h3>To do list</h3>
      <ul class="lead">
        <li>Save a map to work on it later</li>
        <li>Option to add data file to a communal library</li>
        <li>Edit the attribute table</li>
        <li>Delete or merge features</li>          
        <li>Add a legend to a chloropleth</li>
        <li>Support files with multiple geometry layers</li>
        <li>Built-in image fallbacks for code snippets</li>
        <li>Auto-delete weird features (i.e. tiny islands)</li>
        <li>Split a feature into its constituent parts and edit in detail.</li>
        <li>KML importing?  Do people still use KML?</li>          
      </ul>      

      <h3>Get in touch</h3>
      <p class="lead">
        The source is on Github: <a href="https://github.com/veltman/mapstarter">https://github.com/veltman/mapstarter</a>
      </p>
      <p class="lead">
        You can email me at <a href="mailto:noah@noahveltman.com">noah@noahveltman.com</a>, or if you can keep it short, I'm <a href="https://twitter.com/veltman">@veltman</a> on Twitter.
      </p>   

    <h3>Appendix: other tools and resources</h3>
      <ul class="lead">
        <li>If you're just generally map-curious, I wrote a <a href="https://github.com/veltman/learninglunches/tree/master/maps">broad overview on geodata and web maps</a>.</li>
        <li>If you want to make a few basic edits to your underlying data, <a href="http://geojson.io/">geojson.io</a> is pretty handy.  If you want to do more in-depth editing, you'll need desktop software. The fancy and very expensive option is <a href="http://www.esri.com/software/arcgis">ArcGIS</a>; I recommend <a href="http://www.qgis.org/">QGIS</a>, which is free, probably does everything you need, and is more beginner-friendly than you might think.</li>
        <li>To convert a shapefile to GeoJSON, you can use ADC's <a href="http://ogre.adc4gis.com/">online converter</a>.</li>
        <li>If you're a coder or code-curious and have some JavaScript under your belt, Mike Bostock has a great <a href="http://bost.ocks.org/mike/map/">detailed walkthrough</a> that introduces you to many of the fundamentals of mapping with D3.  You can also consult the <a href="https://github.com/mbostock/d3/wiki/Gallery#maps">bountiful list of examples</a>.  I'd probably start with <a href="http://bl.ocks.org/mbostock/4060606">this one</a>.
        </li>
        <li>If you want to make a slippy, Google Maps-style tile map, I highly recommend <a href="http://leafletjs.com/">Leaflet</a>.  It's delightful.  Another option is <a href="http://modestmaps.com/">Modest Maps</a>.</li>
        <li>Shan Carter has a nice tool</li>
        <li>If you want to make a tile map with custom tiles, you can get pretty far with <a href="http://cloudmade.com/">CloudMade</a> or <a href="http://www.mapbox.com/">MapBox</a>.  For full control, you'll probably want to use <a href="http://mapbox.com/tilemill/">TileMill</a>.  Lisa Williams has a <a href="http://dataforradicals.com/the-insanely-illustrated-guide-to-your-first-tile-mill-map/">tutorial on getting started with TileMill</a>.</li>
        <li>If you're in the chloropleth business, the folks at MinnPost have a great utility for that called <a href="http://code.minnpost.com/tulip/">Tulip</a>.</li>
        <li>If you're a developer, <a href="http://kartograph.org/">Kartograph.js</a> is a neat JavaScript library for building SVG maps that also includes support for IE7 and IE8.</li>        
        <li>If you want to build stuff out of geodata and you don't mind paying for the privilege and giving up some control over the details, <a href="http://cartodb.com">CartoDB</a> offers a lot of features (Disclaimer: I've never used it).</li>        
        <li>For detailed geodata about the entire world, <a href="http://wiki.openstreetmap.org/wiki/Main_Page">OpenStreetMap</a> is without equal, and has a vibrant ecosystem of lots of tools and services to help you extract specific data you want.  And it's free!</li>
        <li>For semi-canonical shapefiles of countries of the world, states, provinces, coastlines, or other high-level features, try <a href="http://www.naturalearthdata.com/downloads/">Natural Earth Data</a>.  To get it as TopoJSON, try Mike Bostock's <a href="https://github.com/mbostock/world-atlas">World Atlas</a> tool.
        <li>For US-specific geodata, you can try the <a href="http://www.census.gov/geo/maps-data/data/tiger.html">US Census Bureau</a>, but you'll probably end up in tears.  <a href="http://bl.ocks.org/mbostock/raw/4090846/us.json">This TopoJSON file</a> from Mike Bostock includes US counties and states and may be a shortcut.</li>
        <li>Some news organizations offer boundary services that provide geodata exports for things like congressional districts, city council districts, and ZIP codes.  The <a href="http://boundaries.latimes.com/sets/">Los Angeles Times</a>, <a href="http://boundaries.tribapps.com/">Chicago Tribune</a>, and <a href="http://boundaries.minnpost.com/#datasets">MinnPost</a> both have great ones.
        <li>In the UK, the Ordnance Survey offers <a href="https://www.ordnancesurvey.co.uk/opendatadownload/products.html">some data for download</a> and accepts custom shapefile requests if you're not in a hurry.</li>
        <li>For miscellaneous geodata, you can try <a href="http://geocommons.com/">GeoCommons</a>.</li>    
      </ul>             
    </div><!-- /container -->    

    <div class="container mapstarter-section hidden" id="section-size">
      <h2>Size/Projection Options</h2>
      <div class="panel panel-default">      
        <div class="panel-body">
            <div class="text-center">
              <form class="form-inline">

                <label for="input-width">Width</label><input type="text" class="form-control" id="input-width" value="600" placeholder="Width" /><span class="form-control-static">px</span>

                <label for="input-height">Height</label><input type="text" class="form-control" id="input-height" value="600" placeholder="Height" /><span class="form-control-static">px</span>

                <label for="input-projection">Projection</label><select class="form-control" id="input-projection"><option value="mercator">Mercator (good for world maps)</option><option value="conicEqualArea">Conic Equal Area (good for chloropleths)</option><option value="albersUsa">Albers USA (US only, insets AK and HI)</option><option value="equirectangular">Equirectangular (simple but distorting)</option></select></span>

                <button type="button" class="btn btn-primary map-update">Update</button> 

              </form>
            </div>
        </div>
      </div>      
    </div><!-- /container -->

    <div class="container mapstarter-section hidden" id="section-color">
      <h2>Color/border options</h2>
      <div class="panel panel-default">      
        <div class="panel-body text-center">
          <form class="form-inline">
            <span><label for="color-fill">Fill color</label><input type="color" id="color-fill" value="#4682b4" /></span>
            <span><label for="color-highlight">Highlight color</label><input type="color" id="color-highlight" value="#ff6347" /></span>
            <span><label for="color-stroke">Border color</label><input type="color" id="color-stroke" value="#ffffff" /></span>
            <span><label for="color-stroke-width">Border width</label><input type="text" class="form-control" id="color-stroke-width" placeholder="in px" value="1.5" /></span>

            <button type="button" class="btn btn-primary map-update">Update</button> 
            
          </form>
        </div>
      </div>
    </div><!-- /container -->

    <div class="container mapstarter-section hidden" id="section-behavior">
      <h2>Behavior</h2>
      <div class="panel panel-default">      
        <div class="panel-body text-center">                    
          <span><input type="checkbox" id="zoomable" checked /><label for="zoomable">Click on a feature to zoom</label></span>          
          <span><input type="checkbox" id="pannable" /><label for="pannable">Drag to pan</label></span>
        </div>
      </div>      
    </div><!-- /container -->    

    <div class="container mapstarter-section hidden" id="section-data">
      <h2>Attribute Table</h2>
      <div class="panel panel-default">      
        <div class="panel-body text-center">                    
          <table id="attributes" class="table table-condensed table-hover table-bordered">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>            
    </div><!-- /container -->      

    <div class="container mapstarter-section hidden" id="section-download-svg">
      <h2>Download as an SVG</h2>
      <p class="lead text-center"><a href="#" class="btn btn-primary" id="svg-download">Click here</a> to download as an SVG.</p>
      <div id="svg-div"></div>
    </div><!-- /container -->
    <div class="container mapstarter-section hidden" id="section-download-image">
      <h2>Download as an image</h2>
      <p class="lead text-center"><button type="button" class="btn btn-primary" id="pancake-download">Click here</button> or right-click the image below to save it as a PNG.</p>
      <div id="pancake-div"><img id="pancake-img" /></div>
    </div><!-- /container -->

    <div class="container mapstarter-section hidden" id="section-download-code">
      <h2>Download: Code</h2>
      <pre>
        <code id="download-code" class="html xml">
        </code>
      </pre>
    </div><!-- /container -->    

    <div id="map-box" class="hidden">
      <svg id="map">
        <g id="draggable">
          <g id="features">
          </g>
        </g>
      </svg>
    </div>       

    <div id="junk" class="hidden"></div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery.1.9.1.min.js"></script>

    <!-- D3 and TopoJSON -->
    <script src="js/d3.v3.min.js"></script>
    <script src="js/topojson.v1.min.js"></script>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/hashnav.min.js"></script>
    <script src="js/highlight.min.js"></script>
    <script src="js/pancake.stack.min.js"></script>
    <script src="js/mapstarter.js"></script>
    <script>
      var currentHash = null;

      initHashNav(processHash);

      function processHash(hash) {
          if (currentHash != hash.base) {            
            currentHash = (hash.base.length && (currentFile.data || hash.base == "help")) ? hash.base : "choose-file";
            window.location.hash = currentHash;
          }
          showSection(currentHash);         
      }

      $("ul.navbar-nav a").click(function() {
        if ((!currentFile.data || upload.classed("loading")) && !$(this).attr("href").match(/[#]?(choose-file|help)/)) {
          return false;
        }
      });

      function showSection(section) {        
        $("ul.navbar-nav li").removeClass("active");
        $("li#"+section).addClass("active");
        $("div.mapstarter-section").addClass("hidden");
        $("div#section-"+section).removeClass("hidden");

        if (currentFile && currentFile.data) resetMap();

        if (section.match(/^(download|choose-file|help)/)) {          
          if (section == "download-svg") {            

            $("a#svg-download").attr("download",currentFile.name+".svg").attr("href",window.URL.createObjectURL(new Blob([getSVG()], { "type" : "text/xml" })));            
            return true;
          } else if (section == "download-code") {

            var codeContents = getCode();

            code.text(codeContents);
            hljs.highlightBlock(code.node());

            return true;
          }

          mapBox.classed("hidden",true);

          if (section == "download-image") {            

            var flapjack = Pancake("map");
            $("img#pancake-img").attr("src",flapjack.src);

            $("button#pancake-download").click(function() {
              flapjack.download(currentFile.name+".png");
            });

          }
          if (section == "choose-file") $("div#section-help").removeClass("hidden");

        } else {
          mapBox.classed("hidden",false);
        }
      }

    </script>    
  </body>
</html>